{% load static %}
{% load i18n %} <!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warp Car Rental</title> </head>
<body class="bg-gray-100 font-sarabun">

    {% include 'car_rental/navbar_detail.html' %}

    <div class="container mx-auto flex flex-col md:flex-row p-4 md:p-8 gap-8 pt-24">
        
        <main class="w-full md:w-3/4 bg-white p-8 rounded-lg shadow-lg">
             <div class="flex items-center justify-between mb-8 pb-4 border-b">
                <div class="flex items-center gap-6">
                    {% if user.profile.image %}
                        <img src="{{ user.profile.image.url }}" alt="Profile" class="h-20 w-20 rounded-full object-cover">
                    {% else %}
                        <div class="h-20 w-20 rounded-full bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-user text-gray-400 text-3xl"></i>
                        </div>
                    {% endif %}
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">{{ user.first_name }} {{ user.last_name }}</h2>
                        <p class="text-gray-500">{{ user.email }}</p>
                    </div>
                </div>
            </div>

            <form id="profile-edit-form" method="POST" action="{% url 'profile' %}" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="space-y-5">
                    <div class="flex justify-between items-center border-b pb-3">
                        <span class="text-gray-500 font-medium">{% trans "ชื่อจริง" %}</span>
                        <span class="text-gray-800 font-semibold readonly">{{ user.first_name }}</span>
                        <div class="w-1/2 hidden editable">{{ u_form.first_name }}</div>
                    </div>

                    <div class="flex justify-between items-center border-b pb-3">
                        <span class="text-gray-500 font-medium">{% trans "นามสกุล" %}</span>
                        <span class="text-gray-800 font-semibold readonly">{{ user.last_name }}</span>
                        <div class="w-1/2 hidden editable">{{ u_form.last_name }}</div>
                    </div>

                    <div class="flex justify-between items-center border-b pb-3">
                        <span class="text-gray-500 font-medium">{% trans "เบอร์โทร" %}</span>
                        <span class="text-gray-800 font-semibold readonly">{{ user.profile.phone }}</span>
                        <div class="w-1/2 hidden editable">{{ p_form.phone }}</div>
                    </div>

                    <div class="flex justify-between items-center border-b pb-3">
                        <span class="text-gray-500 font-medium">{% trans "เลขที่ใบขับขี่" %}</span>
                        <span class="text-gray-800 font-semibold readonly">{{ user.profile.license_no }}</span>
                        <div class="w-1/2 hidden editable">{{ p_form.license_no }}</div>
                    </div>

                    <div class="flex justify-between items-center border-b pb-3">
                        <span class="text-gray-500 font-medium">{% trans "อีเมล" %}</span>
                        <span class="text-gray-800 font-semibold readonly">{{ user.email }}</span>
                        <div class="w-1/2 hidden editable">{{ u_form.email }}</div>
                    </div>

                    <div class="flex justify-between items-center border-b pb-3 hidden editable bg-blue-50 p-2 rounded">
                        <span class="text-gray-500 font-medium">{% trans "เปลี่ยนรูปโปรไฟล์" %}</span>
                        <div class="w-1/2">{{ p_form.image }}</div>
                    </div>

                    <div class="flex justify-between items-center border-b pb-3">
                        <span class="text-gray-500 font-medium">{% trans "รหัสผ่าน" %}</span>
                        <span class="text-gray-800 font-semibold">********** <button type="button" id="open-password-modal" class="text-blue-500 hover:underline ml-4 focus:outline-none">
                                {% trans "เปลี่ยนรหัสผ่าน" %}
                            </button>
                        </span>
                    </div>
                </div>
                
                <div class="text-right mt-8 flex justify-end gap-4">
                    <button type="button" id="edit-button" class="bg-[#47B3C4] hover:bg-[#3a9faa] text-white p-3 px-8 rounded-lg font-semibold text-lg transition">{% trans "แก้ไขข้อมูล" %}</button>
                    <button type="button" id="cancel-button" class="bg-gray-200 text-gray-700 p-3 px-8 rounded-lg font-semibold hover:bg-gray-300 hidden transition">{% trans "ยกเลิก" %}</button>
                    <button type="submit" id="save-button" class="bg-[#47B3C4] hover:bg-[#3a9faa] text-white p-3 px-8 rounded-lg font-semibold text-lg hidden transition">{% trans "บันทึกข้อมูลส่วนตัว" %}</button>
                </div>
            </form>
        </main>
    </div>

    <div id="password-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in backdrop-blur-sm">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md popup-slide">
            <h2 class="text-2xl font-bold text-center mb-6">{% trans "เปลี่ยนรหัสผ่าน" %}</h2>
            
            <form method="POST" action="{% url 'change_password' %}" class="space-y-4">
                {% csrf_token %}
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">{% trans "รหัสผ่านเดิม" %}</label>
                    <input type="password" name="old_password" required class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">{% trans "รหัสผ่านใหม่" %}</label>
                    <input type="password" name="new_password1" required class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">{% trans "ยืนยันรหัสผ่านใหม่" %}</label>
                    <input type="password" name="new_password2" required class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                
                <button type="submit" class="w-full bg-[#47B3C4] hover:bg-[#3a9faa] text-white p-3 rounded-lg font-semibold text-lg mt-6 shadow-md transition">
                    {% trans "ยืนยันเปลี่ยนรหัสผ่าน" %}
                </button>
                <button type="button" id="close-password-modal" class="w-full bg-gray-200 text-gray-700 p-3 rounded-lg font-semibold hover:bg-gray-300 mt-2 transition">
                    {% trans "ยกเลิก" %}
                </button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            
            const openModalBtn = document.getElementById('open-password-modal');
            const closeModalBtn = document.getElementById('close-password-modal');
            const modal = document.getElementById('password-modal');
            
            if(openModalBtn) openModalBtn.addEventListener('click', (e) => { e.preventDefault(); modal.classList.remove('hidden'); });
            if(closeModalBtn) closeModalBtn.addEventListener('click', () => { modal.classList.add('hidden'); });
            window.addEventListener('click', (e) => { if (e.target === modal) modal.classList.add('hidden'); });

            
            const editBtn = document.getElementById("edit-button");
            const cancelBtn = document.getElementById("cancel-button");
            const saveBtn = document.getElementById("save-button");
            const editForm = document.getElementById("profile-edit-form");

            if (editBtn) {
                editBtn.addEventListener("click", () => {
                    document.querySelectorAll(".readonly").forEach(el => el.classList.add("hidden"));
                    document.querySelectorAll(".editable").forEach(el => el.classList.remove("hidden"));
                    editBtn.classList.add("hidden");
                    cancelBtn.classList.remove("hidden");
                    saveBtn.classList.remove("hidden");
                });
            }

            if (cancelBtn) {
                cancelBtn.addEventListener("click", () => {
                    document.querySelectorAll(".readonly").forEach(el => el.classList.remove("hidden"));
                    document.querySelectorAll(".editable").forEach(el => el.classList.add("hidden"));
                    editBtn.classList.remove("hidden");
                    cancelBtn.classList.add("hidden");
                    saveBtn.classList.add("hidden");
                    editForm.reset(); 
                });
            }
        });
    </script>
</body>
</html>