{% extends 'base.html' %} 
{% load static %}

{% block content %}
<div class="relative h-screen">

    <div class="absolute inset-0">
        <img src="{% static 'images/background.jpeg' %}" alt="Background Car" class="w-full h-160 object-cover">
        <div class="absolute inset-0 bg-black opacity-30"></div>
    </div>


    <div class="relative z-10 flex items-center justify-center h-full">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-4xl">
            
            <div class="flex border-b mb-6">
    
                <button type="button" id="btn-self"
                    class="py-2 px-6 text-blue-600 border-b-2 border-blue-600 font-semibold text-lg">
                    ‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏ñ‡∏Ç‡∏±‡∏ö‡πÄ‡∏≠‡∏á
                </button>

                <button type="button" id="btn-driver"
                    class="py-2 px-6 text-gray-500 hover:text-gray-700 font-semibold text-lg">
                    ‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏ñ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö
                </button>

                <input type="hidden" name="service_type_form" id="service_type_form" value="SELF_DRIVE">

            </div>


            <form action="{% url 'search_cars' %}" method="get" class="w-full" id="search-form" autocomplete="off">

                <input type="hidden" id="service_type" name="service_type" value="SELF_DRIVE">
                <input type="hidden" name="province" id="province-input">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <div>
                        <div class="mb-4 relative ">
                            <label class="block mb-2">‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏£‡∏ñ</label>
                            <input type="text" name="pickup" id="pickup-input" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà"
                                class="w-full p-3 border border-gray-300 rounded-lg">
                            <button type="button" id="pickup-clear-btn" style="display:none; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #999;">√ó</button>
                            <div id="pickup-suggestions" class="absolute z-20 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg" style="display:none;">
                                </div>
                        </div>

                        <label class="block mb-2">‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <div class="flex gap-2">
                            <input type="text" name="start_date" id="datepicker-start" placeholder="‡∏ß/‡∏î/‡∏õ"
                                class="w-1/3 p-3 border rounded-lg">

                            <input type="text" name="start_time" id="timepicker-start" placeholder="‡πÄ‡∏ß‡∏•‡∏≤"
                                class="w-1/3 p-3 border rounded-lg">

                            <span class="text-gray-500 flex items-center">‡∏ñ‡∏∂‡∏á</span>

                            <input type="text" name="end_date" id="datepicker-end" placeholder="‡∏ß/‡∏î/‡∏õ"
                                class="w-1/3 p-3 border rounded-lg">

                            <input type="text" name="end_time" id="timepicker-end" placeholder="‡πÄ‡∏ß‡∏•‡∏≤"
                                class="w-1/3 p-3 border rounded-lg">
                        </div>
                    </div>

                    <div>
                        <div class="mb-4 relative">
                            <label class="block mb-2">‡∏à‡∏∏‡∏î‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ</label>
                            <input type="text" name="dropoff" id="dropoff-input" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà"
                                class="w-full p-3 border border-gray-300 rounded-lg">
                            <button type="button" id="dropoff-clear-btn" style="display:none; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #999;">√ó</button>
                            <div id="dropoff-suggestions" class="absolute z-20 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg" style="display:none;">
                                </div>
                            
                        </div>

                        <div class="flex items-end gap-4">
                            <div class="flex-1">
                                <label class="block mb-2">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</label>
                                <select name="car_type" class="w-full p-3 border border-gray-300 rounded-lg">
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ --</option>
                                    <option value="SEDAN" {% if car_type == "SEDAN" %}selected{% endif %}>‡∏£‡∏ñ‡πÄ‡∏Å‡πã‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å</option>
                                    <option value="TRUCK" {% if car_type == "TRUCK" %}selected{% endif %}>‡∏£‡∏ñ‡∏Å‡∏£‡∏∞‡∏ö‡∏∞</option>
                                    <option value="VAN" {% if car_type == "VAN" %}selected{% endif %}>‡∏£‡∏ñ‡∏ï‡∏π‡πâ</option>
                                    <option value="EV" {% if car_type == "EV" %}selected{% endif %}>‡∏£‡∏ñ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (EV)</option>

                                </select>
                            </div>

                            <button type="submit" id="search-btn"
                                    class="bg-warp-blue text-white px-6 py-3 rounded-lg">
                                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                            </button>
                        </div>
                    </div>
                </div>
            </form>

        </div>
    </div>
</div>

{% if promotions %}
<div class="bg-gradient-to-r from-blue-600 to-indigo-700 py-6 mb-8 shadow-lg">
    <div class="container mx-auto px-4">
        
        <div class="flex items-center justify-between mb-4 text-white">
            <h2 class="text-2xl font-bold flex items-center">
                <i class="fas fa-tags mr-2 text-yellow-100"></i> ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©
            </h2>
            <span class="text-sm bg-white/20 px-3 py-1 rounded-full">
                ‡∏°‡∏µ {{ promotions.count }} ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
            </span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for promo in promotions %}
            <div class="bg-white rounded-lg p-4 shadow-md flex justify-between items-center relative overflow-hidden group hover:shadow-xl transition transform hover:-translate-y-1">
                
                <div class="absolute -right-6 -top-6 w-20 h-20  rounded-full opacity-50 group-hover:bg-yellow-200 transition"></div>

                <div>
                    <h3 class="font-bold text-gray-800 text-lg">{{ promo.title }}</h3>
                    <p class="text-sm text-gray-500 mb-2">{{ promo.description|truncatechars:40 }}</p>
                    <div class="flex items-center gap-2">
                        <span class="text-red-500 font-bold text-xl">‡∏•‡∏î {{ latest_promo.discount_rate|floatformat:0 }}%</span>
                        <span class="text-xs text-gray-400 border border-gray-200 px-2 py-0.5 rounded">
                            ‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡∏ï {{ promo.end_date|date:"d M y" }}
                        </span>
                    </div>
                </div>

                <div class="text-center z-10">
                    <div class="bg-gray-100 border-2 border-dashed border-gray-400 rounded p-2 mb-1 cursor-pointer hover:bg-blue-50 hover:border-blue-400 transition"
                         onclick="copyCode('{{ promo.code }}')">
                        <span class="font-mono font-bold text-gray-700 text-lg tracking-wider block">
                            {{ promo.code }}
                        </span>
                        <span class="text-[10px] text-gray-400">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</span>
                    </div>
                </div>

            </div>
            {% endfor %}
        </div>

    </div>
</div>
{% endif %}
{% endblock %} 
{% block scripts %}

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ---
        const locations = [
            // --- ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (Provinces) ---
            { name: "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", type: "province", keywords: "bangkok krung thep maha nakhon bkk" },
            { name: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", type: "province", keywords: "samut prakan" },
            { name: "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "nonthaburi" },
            { name: "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", type: "province", keywords: "pathum thani" },
            { name: "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", type: "province", keywords: "phra nakhon si ayutthaya ayutthaya" },
            { name: "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á", type: "province", keywords: "ang thong" },
            { name: "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "lopburi" },
            { name: "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "sing buri" },
            { name: "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó", type: "province", keywords: "chai nat" },
            { name: "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "saraburi" },
            { name: "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "chon buri pattaya" },
            { name: "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", type: "province", keywords: "rayong" },
            { name: "‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "chanthaburi" },
            { name: "‡∏ï‡∏£‡∏≤‡∏î", type: "province", keywords: "trat koh chang" },
            { name: "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤", type: "province", keywords: "chachoengsao" },
            { name: "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "prachin buri" },
            { name: "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å", type: "province", keywords: "nakhon nayok" },
            { name: "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß", type: "province", keywords: "sa kaeo" },
            { name: "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", type: "province", keywords: "nakhon ratchasima korat" },
            { name: "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", type: "province", keywords: "buri ram" },
            { name: "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå", type: "province", keywords: "surin" },
            { name: "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", type: "province", keywords: "si sa ket" },
            { name: "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", type: "province", keywords: "ubon ratchathani ubon" },
            { name: "‡∏¢‡πÇ‡∏™‡∏ò‡∏£", type: "province", keywords: "yasothon" },
            { name: "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥", type: "province", keywords: "chaiyaphum" },
            { name: "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç", type: "province", keywords: "amnat charoen" },
            { name: "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨", type: "province", keywords: "bueng kan" },
            { name: "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π", type: "province", keywords: "nong bua lam phu" },
            { name: "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", type: "province", keywords: "khon kaen" },
            { name: "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", type: "province", keywords: "udon thani udon" },
            { name: "‡πÄ‡∏•‡∏¢", type: "province", keywords: "loei chiang khan" },
            { name: "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢", type: "province", keywords: "nong khai" },
            { name: "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°", type: "province", keywords: "maha sarakham" },
            { name: "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î", type: "province", keywords: "roi et" },
            { name: "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå", type: "province", keywords: "kalasin" },
            { name: "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£", type: "province", keywords: "sakon nakhon" },
            { name: "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°", type: "province", keywords: "nakhon phanom" },
            { name: "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£", type: "province", keywords: "mukdahan" },
            { name: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", type: "province", keywords: "chiang mai" },
            { name: "‡∏•‡∏≥‡∏û‡∏π‡∏ô", type: "province", keywords: "lamphun" },
            { name: "‡∏•‡∏≥‡∏õ‡∏≤‡∏á", type: "province", keywords: "lampang" },
            { name: "‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå", type: "province", keywords: "uttaradit" },
            { name: "‡πÅ‡∏û‡∏£‡πà", type: "province", keywords: "phrae" },
            { name: "‡∏ô‡πà‡∏≤‡∏ô", type: "province", keywords: "nan" },
            { name: "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤", type: "province", keywords: "phayao" },
            { name: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", type: "province", keywords: "chiang rai" },
            { name: "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô", type: "province", keywords: "mae hong son pai" },
            { name: "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", type: "province", keywords: "nakhon sawan" },
            { name: "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ", type: "province", keywords: "uthai thani" },
            { name: "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£", type: "province", keywords: "kamphaeng phet" },
            { name: "‡∏ï‡∏≤‡∏Å", type: "province", keywords: "tak mae sot" },
            { name: "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢", type: "province", keywords: "sukhothai" },
            { name: "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", type: "province", keywords: "phitsanulok" },
            { name: "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£", type: "province", keywords: "phichit" },
            { name: "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå", type: "province", keywords: "phetchabun khao kho" },
            { name: "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "ratchaburi" },
            { name: "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "kanchanaburi" },
            { name: "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "suphan buri" },
            { name: "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°", type: "province", keywords: "nakhon pathom" },
            { name: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", type: "province", keywords: "samut sakhon" },
            { name: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°", type: "province", keywords: "samut songkhram amphawa" },
            { name: "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ", type: "province", keywords: "phetchaburi cha-am" },
            { name: "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå", type: "province", keywords: "prachuap khiri khan hua hin" },
            { name: "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", type: "province", keywords: "nakhon si thammarat" },
            { name: "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", type: "province", keywords: "krabi" },
            { name: "‡∏û‡∏±‡∏á‡∏á‡∏≤", type: "province", keywords: "phangnga khao lak" },
            { name: "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", type: "province", keywords: "phuket" },
            { name: "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", type: "province", keywords: "surat thani samui" },
            { name: "‡∏£‡∏∞‡∏ô‡∏≠‡∏á", type: "province", keywords: "ranong" },
            { name: "‡∏ä‡∏∏‡∏°‡∏û‡∏£", type: "province", keywords: "chumphon" },
            { name: "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", type: "province", keywords: "songkhla hat yai" },
            { name: "‡∏™‡∏ï‡∏π‡∏•", type: "province", keywords: "satun lipe" },
            { name: "‡∏ï‡∏£‡∏±‡∏á", type: "province", keywords: "trang" },
            { name: "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", type: "province", keywords: "phatthalung" },
            { name: "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", type: "province", keywords: "pattani" },
            { name: "‡∏¢‡∏∞‡∏•‡∏≤", type: "province", keywords: "yala betong" },
            { name: "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", type: "province", keywords: "narathiwat" },

            // --- ‚úàÔ∏è ‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô (Airports) ---
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏†‡∏π‡∏°‡∏¥ (BKK)", type: "airport", keywords: "suvarnabhumi bangkok airport bkk" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏î‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á (DMK)", type: "airport", keywords: "don mueang bangkok airport dmk" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà (CNX)", type: "airport", keywords: "chiang mai airport cnx" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (HKT)", type: "airport", keywords: "phuket airport hkt" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà (HDY)", type: "airport", keywords: "hat yai airport songkhla hdy" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡πÅ‡∏°‡πà‡∏ü‡πâ‡∏≤‡∏´‡∏•‡∏ß‡∏á ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢ (CEI)", type: "airport", keywords: "chiang rai airport cei" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏™‡∏°‡∏∏‡∏¢ (USM)", type: "airport", keywords: "samui airport surat thani usm" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà (KBV)", type: "airport", keywords: "krabi airport kbv" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ (UTH)", type: "airport", keywords: "udon thani airport uth" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ (UBP)", type: "airport", keywords: "ubon ratchathani airport ubp" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô (KKC)", type: "airport", keywords: "khon kaen airport kkc" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ (URT)", type: "airport", keywords: "surat thani airport urt" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä (NST)", type: "airport", keywords: "nakhon si thammarat airport nst" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏ï‡∏£‡∏±‡∏á (TST)", type: "airport", keywords: "trang airport tst" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å (PHS)", type: "airport", keywords: "phitsanulok airport phs" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏ô‡πà‡∏≤‡∏ô‡∏ô‡∏Ñ‡∏£ (NNT)", type: "airport", keywords: "nan nakhon airport nnt" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡πÄ‡∏•‡∏¢ (LOE)", type: "airport", keywords: "loei airport loe" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£ (SNO)", type: "airport", keywords: "sakon nakhon airport sno" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î (ROI)", type: "airport", keywords: "roi et airport roi" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏° (KOP)", type: "airport", keywords: "nakhon phanom airport kop" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå (BFV)", type: "airport", keywords: "buri ram airport bfv" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡πÅ‡∏°‡πà‡∏™‡∏≠‡∏î (MAQ)", type: "airport", keywords: "mae sot airport tak maq" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏£‡∏∞‡∏ô‡∏≠‡∏á (UNN)", type: "airport", keywords: "ranong airport unn" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏ä‡∏∏‡∏°‡∏û‡∏£ (CJM)", type: "airport", keywords: "chumphon airport cjm" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏ï‡∏£‡∏≤‡∏î (TDX)", type: "airport", keywords: "trat airport tdx" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢ (THS)", type: "airport", keywords: "sukhothai airport ths" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏•‡∏≥‡∏õ‡∏≤‡∏á (LPT)", type: "airport", keywords: "lampang airport lpt" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô (HGN)", type: "airport", keywords: "mae hong son airport hgn" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏õ‡∏≤‡∏¢ (PYY)", type: "airport", keywords: "pai airport mae hong son pyy" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô (HHQ)", type: "airport", keywords: "hua hin airport prachuap hhq" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏≠‡∏π‡πà‡∏ï‡∏∞‡πÄ‡∏†‡∏≤ (UTP)", type: "airport", keywords: "u-tapao pattaya rayong utp" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™ (NAW)", type: "airport", keywords: "narathiwat airport naw" },
            { name: "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡πÄ‡∏ö‡∏ï‡∏á (BTZ)", type: "airport", keywords: "betong airport yala btz" },

            // --- üöÜ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü (Train Stations) ---
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û (‡∏´‡∏±‡∏ß‡∏•‡∏≥‡πÇ‡∏û‡∏á)", type: "train", keywords: "hua lamphong railway station bangkok" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏≠‡∏†‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡πå (‡∏ö‡∏≤‡∏á‡∏ã‡∏∑‡πà‡∏≠)", type: "train", keywords: "krung thep aphiwat central terminal bang sue" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", type: "train", keywords: "chiang mai railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", type: "train", keywords: "phitsanulok railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", type: "train", keywords: "nakhon sawan railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", type: "train", keywords: "ayutthaya railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", type: "train", keywords: "lopburi railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô", type: "train", keywords: "hua hin railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ä‡∏∏‡∏°‡∏û‡∏£", type: "train", keywords: "chumphon railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", type: "train", keywords: "surat thani railway station phunphin" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ä‡∏∏‡∏°‡∏ó‡∏≤‡∏á‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", type: "train", keywords: "hat yai junction railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏¢‡∏∞‡∏•‡∏≤", type: "train", keywords: "yala railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ï‡∏£‡∏±‡∏á", type: "train", keywords: "trang railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", type: "train", keywords: "nakhon si thammarat railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", type: "train", keywords: "ubon ratchathani railway station warin chamrap" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", type: "train", keywords: "si sa ket railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå", type: "train", keywords: "surin railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", type: "train", keywords: "buri ram railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", type: "train", keywords: "nakhon ratchasima railway station korat" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", type: "train", keywords: "khon kaen railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", type: "train", keywords: "udon thani railway station" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ñ‡πÑ‡∏ü‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢", type: "train", keywords: "nong khai railway station" },

            // --- üöå ‡∏ö‡∏Ç‡∏™. (Bus Terminals) ---
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏´‡∏°‡∏≠‡∏ä‡∏¥‡∏ï 2", type: "bus", keywords: "mo chit 2 bus terminal bangkok northern" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏™‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡πÉ‡∏´‡∏°‡πà", type: "bus", keywords: "sai tai mai southern bus terminal bangkok" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏°‡∏±‡∏¢", type: "bus", keywords: "ekkamai eastern bus terminal bangkok" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≤‡πÄ‡∏Ç‡∏ï ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 2", type: "bus", keywords: "chiang mai arcade bus terminal 2" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≤‡πÄ‡∏Ç‡∏ï ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 3", type: "bus", keywords: "chiang mai arcade bus terminal 3" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢ 1", type: "bus", keywords: "chiang rai bus terminal 1" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï 2", type: "bus", keywords: "phuket bus terminal 2" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", type: "bus", keywords: "hat yai bus terminal" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤ 2", type: "bus", keywords: "nakhon ratchasima bus terminal 2 korat" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô 3", type: "bus", keywords: "khon kaen bus terminal 3" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ 1", type: "bus", keywords: "udon thani bus terminal 1" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", type: "bus", keywords: "ubon ratchathani bus terminal" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏û‡∏±‡∏ó‡∏¢‡∏≤ (‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á)", type: "bus", keywords: "pattaya bus terminal rung ruang" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô", type: "bus", keywords: "hua hin bus terminal" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏£‡∏∞‡∏¢‡∏≠‡∏á 2", type: "bus", keywords: "rayong bus terminal 2" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å 2", type: "bus", keywords: "phitsanulok bus terminal 2" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", type: "bus", keywords: "surat thani bus terminal" },
            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", type: "bus", keywords: "krabi bus terminal" }
        ];

        // --- 2. ‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏Ç‡∏±‡∏ö‡πÄ‡∏≠‡∏á/‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö) ---
        const btnSelf = document.getElementById('btn-self');
        const btnDriver = document.getElementById('btn-driver');
        const serviceTypeInput = document.getElementById('service_type');

        function setActiveButton(activeBtn, inactiveBtn, serviceValue) {
            activeBtn.classList.remove('text-gray-500', 'hover:text-gray-700', 'border-b-0');
            activeBtn.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
            
            inactiveBtn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
            inactiveBtn.classList.add('text-gray-500', 'hover:text-gray-700', 'border-b-0');
            
            if(serviceTypeInput) serviceTypeInput.value = serviceValue;
        }

        if(btnSelf) {
             btnSelf.addEventListener('click', function() {
                setActiveButton(btnSelf, btnDriver, 'SELF_DRIVE');
            });
        }
       
        if(btnDriver) {
            btnDriver.addEventListener('click', function() {
                setActiveButton(btnDriver, btnSelf, 'WITH_DRIVER');
            });
        }

        // --- Helper Functions ---
        function getIcon(type) {
            if (type === 'airport') return '<i class="fas fa-plane-departure text-gray-400 mr-2 w-6 text-center"></i>';
            if (type === 'train') return '<i class="fas fa-train text-gray-400 mr-2 w-6 text-center"></i>';
            if (type === 'bus') return '<i class="fas fa-bus text-gray-400 mr-2 w-6 text-center"></i>';
            return '<i class="fas fa-map-marker-alt text-[#48a9b9] mr-2 w-6 text-center"></i>'; // ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
        }

        function extractProvince(loc) {
            if (loc.type === "province") return loc.name;
            const provinces = locations.filter(l => l.type === "province");
            for (const p of provinces) {
                if (loc.name.includes(p.name) || (loc.keywords && loc.keywords.includes(p.name))) {
                    return p.name;
                }
            }
            return "";
        }

        // --- 3. ‡∏£‡∏∞‡∏ö‡∏ö Auto-Suggestion (Updated Logic) ---
        function setupLocationInput(inputID, suggestionBoxID, clearBtnID, copyValue = false) {
            const input = document.getElementById(inputID);
            const box = document.getElementById(suggestionBoxID);
            const clearBtn = document.getElementById(clearBtnID);
            const dropoffInput = document.getElementById('dropoff-input');
            const provinceInput = document.getElementById('province-input'); // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ input hidden ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
            
            // Set style for box
            if(box) box.style.cssText += "max-height: 280px; overflow-y: auto; overflow-x: hidden;";

            if (!input || !box) return;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Function ‡∏™‡∏£‡πâ‡∏≤‡∏á Element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢
            function createItemElement(loc, isSubItem = false) {
                const div = document.createElement('div');
                // CSS inline ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö code ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á homepage
                const paddingLeft = isSubItem ? '30px' : '15px';
                div.style.cssText = `padding: 10px 15px 10px ${paddingLeft}; cursor: pointer; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; background-color: white;`;
                
                div.innerHTML = `${getIcon(loc.type)}<span style="color:#333; font-size:14px;">${loc.name}</span>`;
                
                div.onmouseover = function() { this.style.backgroundColor = "#f3f4f6"; };
                div.onmouseout = function() { this.style.backgroundColor = "white"; };

                div.onclick = function() {
                    input.value = loc.name;
                    box.style.display = 'none';
                    if (copyValue && dropoffInput) dropoffInput.value = loc.name;
                    
                    // Set province hidden value if exists
                    if(provinceInput) provinceInput.value = extractProvince(loc);
                };
                return div;
            }

            input.addEventListener('input', function() {
                const val = this.value.toLowerCase().trim();
                box.innerHTML = '';

                if (val.length > 0) {
                    box.style.display = 'block';
                    if(clearBtn) clearBtn.style.display = 'block';

                    // 1. ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    const allMatches = locations.filter(l => 
                        l.name.toLowerCase().includes(val) || (l.keywords && l.keywords.includes(val))
                    );
                    
                    const matchedProvinces = allMatches.filter(l => l.type === 'province');
                    const matchedPlaces = allMatches.filter(l => l.type !== 'province');
                    
                    let hasResults = false;

                    // 2. Logic ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                    // Case A: ‡πÄ‡∏à‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡πÅ‡∏™‡∏î‡∏á Header + ‡∏•‡∏π‡∏Å‡∏Ç‡πà‡∏≤‡∏¢)
                    if (matchedProvinces.length > 0) {
                        hasResults = true;
                        matchedProvinces.forEach(prov => {
                            // Header ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
                            const header = document.createElement('div');
                            header.style.cssText = "padding: 8px 15px; font-size: 13px; color: #4b5563; background: #e5e7eb; font-weight: bold; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #d1d5db;";
                            header.innerHTML = `<i class="fas fa-map-marker-alt" style="color:#48a9b9; margin-right:8px;"></i>${prov.name}`;
                            box.appendChild(header);

                            // ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏¢‡πà‡∏≠‡∏¢‡πÉ‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡∏µ‡πâ
                            const subLocations = matchedPlaces.filter(place => {
                                return place.name.includes(prov.name) || (place.keywords && place.keywords.includes(prov.name));
                            });

                            if (subLocations.length > 0) {
                                subLocations.forEach(sub => {
                                    box.appendChild(createItemElement(sub, true));
                                });
                            } else {
                                const emptyMsg = document.createElement('div');
                                emptyMsg.style.cssText = "padding: 10px 30px; font-size: 12px; color: #9ca3af; font-style: italic; background: white;";
                                emptyMsg.innerText = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏£‡∏ñ‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ';
                                box.appendChild(emptyMsg);
                            }
                        });
                    }
                    // Case B: ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏´‡∏£‡∏∑‡∏≠ ‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏ï‡∏¥)
                    else if (matchedPlaces.length > 0) {
                        hasResults = true;
                        // Header ‡∏õ‡∏Å‡∏ï‡∏¥
                        const header = document.createElement('div');
                        header.style.cssText = "padding: 8px 15px; font-size: 12px; color: #999; background: #f5f5f5; font-weight: bold; position: sticky; top: 0; z-index: 10;";
                        header.innerText = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥';
                        box.appendChild(header);

                        matchedPlaces.forEach(loc => {
                            box.appendChild(createItemElement(loc, false));
                        });
                    }

                    if (!hasResults) {
                        box.style.display = 'none';
                    }

                } else {
                    box.style.display = 'none';
                    if(clearBtn) clearBtn.style.display = 'none';
                }
            });

            if(clearBtn) {
                clearBtn.addEventListener('click', () => {
                    input.value = '';
                    box.style.display = 'none';
                    clearBtn.style.display = 'none';
                    input.focus();
                    if (copyValue && dropoffInput) dropoffInput.value = '';
                });
            }

            document.addEventListener('click', (e) => {
                if (!input.contains(e.target) && !box.contains(e.target)) {
                    box.style.display = 'none';
                }
            });
        }
        
        setupLocationInput('pickup-input', 'pickup-suggestions', 'pickup-clear-btn', true);
        setupLocationInput('dropoff-input', 'dropoff-suggestions', 'dropoff-clear-btn', false);

        // --- 4. ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ---
        // const searchBtn = document.getElementById('search-btn');

        // --- 5. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Drivehub Style) ---
        const now = new Date();
        const pickupDate = new Date(now);
        pickupDate.setDate(now.getDate() + 1);
        
        if (pickupDate.getMinutes() < 30) {
            pickupDate.setMinutes(30);
        } else {
            pickupDate.setHours(pickupDate.getHours() + 1);
            pickupDate.setMinutes(0);
        }

        const dropoffDate = new Date(pickupDate);
        dropoffDate.setDate(pickupDate.getDate() + 1);

        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏™‡∏£‡πâ‡∏≤‡∏á "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤" ‡∏Å‡∏±‡∏ô‡πÄ‡∏Ñ‡∏™‡∏ö‡∏≤‡∏á browser ‡∏´‡∏•‡∏∏‡∏î‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const endPicker = flatpickr("#datepicker-end", { 
            dateFormat: "d/m/Y", 
            defaultDate: dropoffDate,
            minDate: dropoffDate // ‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ = ‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏ñ+1 ‡∏ß‡∏±‡∏ô
        });

        
// ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô: ‡πÄ‡∏Å‡πá‡∏ö instance ‡∏Ç‡∏≠‡∏á startPicker ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° onChange
        const startPicker = flatpickr("#datepicker-start", { 
            dateFormat: "d/m/Y", 
            defaultDate: pickupDate,
            minDate: today, // ‚úÖ ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ä‡∏±‡∏ß‡∏£‡πå

            // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡πÄ‡∏ß‡∏•‡∏≤ user ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏ñ -> ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ >= ‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏ñ + 1 ‡∏ß‡∏±‡∏ô
            onChange: function(selectedDates) {
                if (!selectedDates.length) return;

                const startDate = selectedDates[0];

                // ‚úÖ min ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ = ‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏ñ + 1 ‡∏ß‡∏±‡∏ô
                const minDropoff = new Date(startDate);
                minDropoff.setDate(startDate.getDate() + 1);

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï minDate ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ
                endPicker.set("minDate", minDropoff);

                // ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ‡πÄ‡∏î‡∏¥‡∏°‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ min -> ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                if (!endPicker.selectedDates.length || endPicker.selectedDates[0] < minDropoff) {
                    endPicker.setDate(minDropoff, true);
                }
            }
        });
        
        flatpickr("#timepicker-start", { 
            enableTime: true, 
            noCalendar: true, 
            dateFormat: "H:i", 
            time_24hr: true,
            defaultDate: pickupDate
        });
        
        flatpickr("#timepicker-end", { 
            enableTime: true, 
            noCalendar: true, 
            dateFormat: "H:i", 
            time_24hr: true,
            defaultDate: dropoffDate
        });
    });
    function copyCode(code) {
    navigator.clipboard.writeText(code);
    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ß‡∏¢‡πÜ (‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ alert ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡∏Å‡πá‡πÑ‡∏î‡πâ)
    alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î " + code + " ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢");
}
</script>

{% endblock %}